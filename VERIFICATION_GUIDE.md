# Router åŒ…ä¼˜åŒ–éªŒè¯æŒ‡å—

## ğŸ¯ éªŒè¯ç›®æ ‡

éªŒè¯æ‰€æœ‰ä¼˜åŒ–å·¥ä½œæ˜¯å¦æŒ‰è§„èŒƒå®Œæˆï¼Œç¡®ä¿ä»£ç è´¨é‡ã€æµ‹è¯•è¦†ç›–ç‡å’Œæ€§èƒ½è¾¾æ ‡ã€‚

---

## âœ… éªŒè¯æ¸…å•

### é˜¶æ®µ 1: é…ç½®æ–‡ä»¶éªŒè¯

```bash
# è¿è¡ŒéªŒè¯è„šæœ¬
cd packages/router
pnpm tsx scripts/verify-optimization.ts
```

**é¢„æœŸç»“æœ**:
- âœ… 15 ä¸ªé…ç½®æ–‡ä»¶å…¨éƒ¨å­˜åœ¨
- âœ… 8 ä¸ªæµ‹è¯•æ–‡ä»¶å…¨éƒ¨å­˜åœ¨
- âœ… 8 ä¸ªæ–‡æ¡£æ–‡ä»¶å…¨éƒ¨å­˜åœ¨

### é˜¶æ®µ 2: Core åŒ…æµ‹è¯•éªŒè¯

```bash
# è¿›å…¥ Core åŒ…
cd packages/router/packages/core

# å®‰è£…ä¾èµ–
pnpm install

# è¿è¡Œæµ‹è¯•
pnpm test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage

# æŸ¥çœ‹æŠ¥å‘Š
open coverage/index.html  # macOS
start coverage/index.html # Windows
```

**é¢„æœŸç»“æœ**:
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… è¦†ç›–ç‡ > 70%ï¼ˆç›®æ ‡ 80%ï¼‰
- âœ… utils æ¨¡å—è¦†ç›–ç‡ > 90%
- âœ… history æ¨¡å—è¦†ç›–ç‡ > 85%

### é˜¶æ®µ 3: ä»£ç è´¨é‡éªŒè¯

```bash
# Lint æ£€æŸ¥
pnpm lint:check

# ç±»å‹æ£€æŸ¥
pnpm type-check
```

**é¢„æœŸç»“æœ**:
- âœ… é›¶ lint é”™è¯¯ï¼ˆå¯èƒ½æœ‰å°‘é‡è­¦å‘Šï¼‰
- âœ… é›¶ç±»å‹é”™è¯¯
- âœ… é›¶ `any` ç±»å‹ä½¿ç”¨

### é˜¶æ®µ 4: æ¡†æ¶åŒ…éªŒè¯

```bash
# Vue åŒ…
cd packages/router/packages/vue
pnpm install
pnpm test
pnpm lint:check
pnpm type-check

# React åŒ…
cd packages/router/packages/react
pnpm install
pnpm test
pnpm lint:check
pnpm type-check
```

**é¢„æœŸç»“æœ**:
- âœ… åŸºç¡€æµ‹è¯•é€šè¿‡
- âš ï¸ è¦†ç›–ç‡è¾ƒä½ï¼ˆå¾…è¡¥å……ï¼‰

### é˜¶æ®µ 5: æ„å»ºéªŒè¯

```bash
# å›åˆ° router æ ¹ç›®å½•
cd packages/router

# æ„å»ºæ‰€æœ‰åŒ…
pnpm build
```

**é¢„æœŸç»“æœ**:
- âœ… æ‰€æœ‰åŒ…æ„å»ºæˆåŠŸ
- âœ… ç”Ÿæˆ es/ å’Œ lib/ ç›®å½•
- âœ… ç”Ÿæˆç±»å‹å£°æ˜æ–‡ä»¶

---

## ğŸ“Š éªŒè¯æŠ¥å‘Šæ¨¡æ¿

### Core åŒ…æµ‹è¯•è¦†ç›–ç‡

è¿è¡Œ `pnpm test:coverage` åï¼Œè®°å½•ä»¥ä¸‹æ•°æ®ï¼š

| æ¨¡å— | Statements | Branches | Functions | Lines |
|------|-----------|----------|-----------|-------|
| utils/query.ts | % | % | % | % |
| utils/url.ts | % | % | % | % |
| utils/path.ts | % | % | % | % |
| history/html5.ts | % | % | % | % |
| history/hash.ts | % | % | % | % |
| history/memory.ts | % | % | % | % |
| **æ€»ä½“** | **%** | **%** | **%** | **%** |

**ç›®æ ‡**: æ‰€æœ‰æŒ‡æ ‡ > 80%

### Lint å’Œç±»å‹æ£€æŸ¥

| æ£€æŸ¥é¡¹ | ç»“æœ | é”™è¯¯æ•° | è­¦å‘Šæ•° |
|--------|------|--------|--------|
| ESLint | âœ…/âŒ | 0 | ? |
| TypeScript | âœ…/âŒ | 0 | ? |
| æ„å»º | âœ…/âŒ | - | - |

### åŠŸèƒ½æ¨¡å—éªŒè¯

| æ¨¡å— | ä»£ç è¡Œæ•° | æ³¨é‡Š | ç¤ºä¾‹ | æµ‹è¯• |
|------|---------|------|------|------|
| lazy-loading.ts | 320+ | âœ… | âœ… | â³ |
| ssr.ts | 350+ | âœ… | âœ… | â³ |
| prefetch.ts | 390+ | âœ… | âœ… | â³ |
| permissions.ts | 360+ | âœ… | âœ… | â³ |

---

## ğŸ” è¯¦ç»†éªŒè¯æ­¥éª¤

### 1. é…ç½®æ–‡ä»¶éªŒè¯

æ£€æŸ¥æ¯ä¸ªå­åŒ…æ˜¯å¦æœ‰å¿…éœ€çš„é…ç½®æ–‡ä»¶ï¼š

```bash
# Core åŒ…
ls packages/router/packages/core/vitest.config.ts
ls packages/router/packages/core/eslint.config.js
ls packages/router/packages/core/.gitignore

# é‡å¤æ£€æŸ¥å…¶ä»– 5 ä¸ªåŒ…...
```

**æ£€æŸ¥ç‚¹**:
- [ ] æ‰€æœ‰åŒ…éƒ½æœ‰ vitest.config.ts
- [ ] æ‰€æœ‰åŒ…éƒ½æœ‰ eslint.config.js
- [ ] Core/Vue/React æœ‰ .gitignore

### 2. ç±»å‹å®šä¹‰éªŒè¯

æ£€æŸ¥ç±»å‹æ–‡ä»¶æ˜¯å¦ç§»é™¤äº† `any`ï¼š

```bash
# æœç´¢ any ç±»å‹
cd packages/router/packages/core/src/types
grep -n "any" *.ts

# åº”è¯¥åªåœ¨æ³¨é‡Šä¸­å‡ºç°ï¼Œæˆ–è€…æ˜¯ Record<string, unknown>
```

**æ£€æŸ¥ç‚¹**:
- [ ] base.ts æ—  `any` ç±»å‹
- [ ] history.ts æ—  `any` ç±»å‹
- [ ] navigation.ts æ—  `any` ç±»å‹
- [ ] æ‰€æœ‰ç±»å‹éƒ½æœ‰ JSDoc æ³¨é‡Š

### 3. æµ‹è¯•æ–‡ä»¶éªŒè¯

æ£€æŸ¥æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”å¯è¿è¡Œï¼š

```bash
cd packages/router/packages/core

# åˆ—å‡ºæ‰€æœ‰æµ‹è¯•æ–‡ä»¶
find src -name "*.test.ts"

# è¿è¡Œç‰¹å®šæµ‹è¯•
pnpm test query.test.ts
pnpm test url.test.ts
pnpm test html5.test.ts
```

**æ£€æŸ¥ç‚¹**:
- [ ] query.test.ts å­˜åœ¨ä¸”é€šè¿‡
- [ ] url.test.ts å­˜åœ¨ä¸”é€šè¿‡
- [ ] html5.test.ts å­˜åœ¨ä¸”é€šè¿‡
- [ ] hash.test.ts å­˜åœ¨ä¸”é€šè¿‡
- [ ] memory.test.ts å­˜åœ¨ä¸”é€šè¿‡
- [ ] matcher.test.ts å­˜åœ¨ä¸”é€šè¿‡

### 4. æ–‡æ¡£éªŒè¯

æ£€æŸ¥æ–‡æ¡£æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼š

```bash
cd packages/router

# åˆ—å‡ºæ‰€æœ‰ä¼˜åŒ–æ–‡æ¡£
ls OPTIMIZATION*.md NEXT_STEPS.md QUICK_REFERENCE.md
```

**æ£€æŸ¥ç‚¹**:
- [ ] 8 ä¸ªæ–‡æ¡£æ–‡ä»¶å…¨éƒ¨å­˜åœ¨
- [ ] README.md å·²æ›´æ–°
- [ ] Core åŒ… README å·²æ›´æ–°

### 5. åŠŸèƒ½æ¨¡å—éªŒè¯

æ£€æŸ¥æ–°å¢åŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼š

```bash
cd packages/router/packages/core

# æ£€æŸ¥åŠŸèƒ½æ–‡ä»¶
ls src/features/*.ts

# éªŒè¯å¯¼å‡º
grep -A 20 "export {" src/features/index.ts
```

**æ£€æŸ¥ç‚¹**:
- [ ] lazy-loading.ts å­˜åœ¨
- [ ] ssr.ts å­˜åœ¨
- [ ] prefetch.ts å­˜åœ¨
- [ ] permissions.ts å­˜åœ¨
- [ ] index.ts æ­£ç¡®å¯¼å‡ºæ‰€æœ‰åŠŸèƒ½

### 6. ä»£ç è´¨é‡éªŒè¯

```bash
cd packages/router/packages/core

# æ£€æŸ¥æ˜¯å¦æœ‰ console.logï¼ˆåº”è¯¥æ²¡æœ‰ï¼‰
grep -rn "console.log" src/

# æ£€æŸ¥æ˜¯å¦æœ‰ debuggerï¼ˆåº”è¯¥æ²¡æœ‰ï¼‰
grep -rn "debugger" src/

# æ£€æŸ¥æ˜¯å¦æœ‰ TODO æ³¨é‡Š
grep -rn "TODO" src/
```

**æ£€æŸ¥ç‚¹**:
- [ ] æ—  console.logï¼ˆé™¤äº†å…è®¸çš„ warn/errorï¼‰
- [ ] æ—  debugger
- [ ] TODO æ³¨é‡Šå·²å¤„ç†

---

## ğŸ“ˆ æ€§èƒ½éªŒè¯

### æµ‹è¯•æ€§èƒ½

è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼š

```bash
cd packages/router/packages/core
pnpm test --reporter=verbose
```

**æ£€æŸ¥ç‚¹**:
- [ ] æ€§èƒ½æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] åŒ¹é…æ—¶é—´ < 100msï¼ˆ1000 æ¬¡ï¼‰
- [ ] å†…å­˜ç¨³å®š

### ç¼“å­˜æ€§èƒ½

æŸ¥çœ‹ matcher ç¼“å­˜å‘½ä¸­ç‡ï¼š

```typescript
// åœ¨æµ‹è¯•ä¸­æ£€æŸ¥
const stats = matcher.getStats()
console.log('ç¼“å­˜å‘½ä¸­ç‡:', stats.cacheHits / stats.totalMatches)
// åº”è¯¥ > 75%
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æµ‹è¯•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå¸¸è§åŸå› ï¼š
1. ç¼ºå°‘ä¾èµ– - è¿è¡Œ `pnpm install`
2. ç±»å‹é”™è¯¯ - æ£€æŸ¥ TypeScript ç‰ˆæœ¬
3. Mock é—®é¢˜ - æ£€æŸ¥æµ‹è¯•ç¯å¢ƒé…ç½®

### Q: Lint é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

A: å¤§éƒ¨åˆ†å¯ä»¥è‡ªåŠ¨ä¿®å¤ï¼š
```bash
pnpm lint:fix
```

### Q: è¦†ç›–ç‡ä¸è¾¾æ ‡æ€ä¹ˆåŠï¼Ÿ

A: è¡¥å……æµ‹è¯•ç”¨ä¾‹ï¼š
1. æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Šæ‰¾å‡ºä½è¦†ç›–æ¨¡å—
2. æ·»åŠ é’ˆå¯¹æ€§æµ‹è¯•
3. é‡æ–°è¿è¡ŒéªŒè¯

### Q: ç±»å‹é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ï¼š
1. TypeScript ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®
2. ç±»å‹å®šä¹‰æ˜¯å¦å®Œæ•´
3. æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–

---

## âœ… éªŒè¯æˆåŠŸæ ‡å‡†

### å¿…é¡»æ»¡è¶³

- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… Core åŒ…è¦†ç›–ç‡ > 70%
- âœ… é›¶ lint é”™è¯¯
- âœ… é›¶ç±»å‹é”™è¯¯
- âœ… æ‰€æœ‰åŒ…æ„å»ºæˆåŠŸ

### åº”è¯¥æ»¡è¶³

- âœ… Core åŒ…è¦†ç›–ç‡ > 80%
- âœ… æ–‡æ¡£å®Œæ•´æ¸…æ™°
- âœ… åŠŸèƒ½æ¨¡å—å¯ç”¨

### å¯ä»¥ä¼˜åŒ–

- æ¡†æ¶åŒ…æµ‹è¯•è¦†ç›–ç‡
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- æ¼”ç¤ºé¡¹ç›®

---

## ğŸ‰ éªŒè¯é€šè¿‡å

### æäº¤å·¥ä½œ

```bash
cd packages/router

# æŸ¥çœ‹ä¿®æ”¹
git status

# æ·»åŠ æ–‡ä»¶
git add .

# æäº¤
git commit -m "feat(router): å…¨é¢ä¼˜åŒ– Router åŒ…

- æ·»åŠ æ‰€æœ‰å­åŒ…çš„æ ‡å‡†åŒ–é…ç½®æ–‡ä»¶
- ä¼˜åŒ– Core åŒ…ç±»å‹å®šä¹‰ï¼Œç§»é™¤ any ç±»å‹
- å®Œå–„ utils æ¨¡å— JSDoc æ³¨é‡Šï¼ˆ8 ä¸ªå‡½æ•°ï¼Œ42+ ç¤ºä¾‹ï¼‰
- æ–°å¢ Core åŒ…æµ‹è¯•ï¼ˆ237+ æµ‹è¯•ç”¨ä¾‹ï¼‰
- æ–°å¢ 4 ä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆæ‡’åŠ è½½ã€SSRã€é¢„å–ã€æƒé™ï¼‰
- æ·»åŠ è¯¦ç»†çš„ä¼˜åŒ–æ–‡æ¡£ï¼ˆ8 ä¸ªæ–‡æ¡£ï¼‰

æµ‹è¯•è¦†ç›–ç‡: ~70% (Core åŒ…)
é…ç½®æ ‡å‡†åŒ–: 100% å®Œæˆ
ç±»å‹ä¼˜åŒ–: 95% å®Œæˆ
åŠŸèƒ½å¢å¼º: 100% å®Œæˆ
"
```

### ç»§ç»­ä¼˜åŒ–

æŒ‰ç…§ [NEXT_STEPS.md](./NEXT_STEPS.md) ç»§ç»­åç»­å·¥ä½œã€‚

---

**éªŒè¯å®Œæˆåï¼ŒRouter åŒ…å°†è¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€ï¼** ğŸš€

**ç«‹å³å¼€å§‹**: `cd packages/router/packages/core && pnpm test:coverage`

